<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roleta Premiada â€” Mercado CastelÃ£o</title>
    <style>
        :root {
            --blue-0: #07162d;
            --blue-1: #0a2350;
            --orange-1: #ff7a00;
            --orange-2: #ff9a2a;
            --white: #eef6ff;
            --muted: rgba(238, 246, 255, .72);
            --stroke: rgba(255, 255, 255, .14);
            --shadow: 0 18px 55px rgba(0, 0, 0, .55);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            color: var(--white);
            background:
                radial-gradient(900px 520px at 18% 10%, rgba(255, 122, 0, .28), transparent 60%),
                radial-gradient(900px 520px at 85% 22%, rgba(10, 35, 80, .60), transparent 55%),
                radial-gradient(700px 520px at 55% 115%, rgba(255, 154, 42, .22), transparent 60%),
                linear-gradient(180deg, var(--blue-0), var(--blue-1));
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 18px;
            overflow-x: hidden;
        }

        .app {
            width: min(560px, 100%);
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 18px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .10), rgba(255, 255, 255, .06));
            border: 1px solid var(--stroke);
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            flex: 1;
            min-width: 0;
            position: relative;
            overflow: hidden;
        }

        .brand::after {
            content: "";
            position: absolute;
            inset: -50%;
            background:
                radial-gradient(circle at 30% 30%, rgba(255, 122, 0, .18), transparent 55%),
                radial-gradient(circle at 70% 70%, rgba(10, 35, 80, .30), transparent 55%);
            pointer-events: none;
        }

        .brand>* {
            position: relative;
            z-index: 1;
        }

        .brand img {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            object-fit: cover;
            border: 1px solid rgba(255, 255, 255, .25);
            box-shadow: 0 12px 26px rgba(0, 0, 0, .35);
            background: rgba(255, 255, 255, .06);
        }

        .brand .t {
            display: flex;
            flex-direction: column;
            line-height: 1.15;
            min-width: 0;
        }

        .brand .t strong {
            font-size: 14px;
            letter-spacing: .3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .brand .t span {
            font-size: 12px;
            color: var(--muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .badge {
            padding: 11px 12px;
            border-radius: 18px;
            border: 1px solid rgba(255, 122, 0, .35);
            background: linear-gradient(180deg, rgba(255, 122, 0, .22), rgba(255, 122, 0, .08));
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
            font-size: 12px;
            color: rgba(255, 255, 255, .92);
            text-align: center;
            min-width: 120px;
            white-space: nowrap;
        }

        .card {
            padding: 14px;
            border-radius: 24px;
            background: linear-gradient(180deg, rgba(255, 255, 255, .10), rgba(255, 255, 255, .06));
            border: 1px solid var(--stroke);
            box-shadow: var(--shadow);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: -2px;
            background:
                radial-gradient(800px 520px at 20% 10%, rgba(255, 122, 0, .12), transparent 60%),
                radial-gradient(700px 520px at 85% 30%, rgba(10, 35, 80, .22), transparent 55%);
            pointer-events: none;
        }

        .card>* {
            position: relative;
            z-index: 1;
        }

        .hint {
            font-size: 13px;
            color: var(--muted);
            margin: 0;
            line-height: 1.45;
        }

        .hint b {
            color: rgba(255, 255, 255, .95);
        }

        .wheelWrap {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 14px 8px 8px;
        }

        .wheelStage {
            position: relative;
            width: min(390px, 92vw);
            aspect-ratio: 1/1;
            border-radius: 999px;
            display: grid;
            place-items: center;
            transform-style: preserve-3d;
            perspective: 1200px;
        }

        .wheelStage::before {
            content: "";
            position: absolute;
            inset: -10px;
            border-radius: 999px;
            background:
                radial-gradient(circle at 30% 25%, rgba(255, 255, 255, .14), transparent 35%),
                radial-gradient(circle at 70% 70%, rgba(255, 122, 0, .18), transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(0, 0, 0, .35), rgba(0, 0, 0, .68));
            transform: translateZ(-40px);
            box-shadow: 0 35px 90px rgba(0, 0, 0, .70);
            pointer-events: none;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 999px;
            background: rgba(255, 255, 255, .03);
            box-shadow:
                inset 0 18px 45px rgba(0, 0, 0, .45),
                inset 0 -18px 40px rgba(255, 255, 255, .06),
                0 22px 68px rgba(0, 0, 0, .60);
            border: 1px solid rgba(255, 255, 255, .14);
            transform: rotateX(8deg);
            transform-origin: center;
        }

        .rim {
            position: absolute;
            inset: 8px;
            border-radius: 999px;
            border: 2px solid rgba(255, 255, 255, .14);
            box-shadow:
                inset 0 10px 25px rgba(255, 255, 255, .08),
                inset 0 -12px 26px rgba(0, 0, 0, .35),
                0 0 0 10px rgba(0, 0, 0, .10);
            pointer-events: none;
            transform: rotateX(8deg);
        }

        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 16px solid transparent;
            border-right: 16px solid transparent;
            border-bottom: 34px solid rgba(255, 255, 255, .94);
            filter: drop-shadow(0 10px 12px rgba(0, 0, 0, .55));
            z-index: 10;
        }

        .pointer::after {
            content: "";
            position: absolute;
            left: -8px;
            top: 10px;
            width: 16px;
            height: 16px;
            border-radius: 999px;
            background: linear-gradient(180deg, var(--orange-2), var(--orange-1));
            box-shadow: 0 10px 25px rgba(0, 0, 0, .55);
        }

        .center {
            position: absolute;
            width: 42%;
            aspect-ratio: 1/1;
            border-radius: 999px;
            display: grid;
            place-items: center;
            z-index: 9;
            transform: translateZ(40px) rotateX(8deg);
        }

        .center::before {
            content: "";
            position: absolute;
            inset: -10px;
            border-radius: 999px;
            background:
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, .22), transparent 45%),
                radial-gradient(circle at 70% 75%, rgba(255, 122, 0, .20), transparent 52%),
                linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(0, 0, 0, .22));
            box-shadow: 0 25px 65px rgba(0, 0, 0, .60);
            border: 1px solid rgba(255, 255, 255, .16);
            pointer-events: none;
        }

        .startBtn {
            position: relative;
            width: 86%;
            height: 86%;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            color: #041328;
            font-weight: 1000;
            letter-spacing: .7px;
            font-size: 15px;
            background:
                radial-gradient(circle at 35% 30%, rgba(255, 255, 255, .98), rgba(255, 255, 255, .62));
            box-shadow:
                inset 0 10px 18px rgba(255, 255, 255, .55),
                inset 0 -12px 18px rgba(0, 0, 0, .18),
                0 24px 60px rgba(0, 0, 0, .68);
            display: grid;
            place-items: center;
            overflow: hidden;
            transition: transform .15s ease, filter .2s ease;
        }

        .startBtn:active {
            transform: scale(.98);
        }

        .startBtn.isReady {
            animation: readyPulse 1.25s ease-in-out infinite;
            box-shadow:
                inset 0 10px 18px rgba(255, 255, 255, .60),
                inset 0 -12px 18px rgba(0, 0, 0, .16),
                0 0 0 2px rgba(255, 154, 42, .25),
                0 0 45px rgba(255, 122, 0, .45),
                0 24px 60px rgba(0, 0, 0, .68);
        }

        .startBtn.isReady::after {
            content: "";
            position: absolute;
            inset: -60%;
            background: radial-gradient(circle, rgba(255, 122, 0, .22), transparent 55%);
            animation: readyGlow 1.25s ease-in-out infinite;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        @keyframes readyPulse {

            0%,
            100% {
                transform: scale(1);
                filter: saturate(1);
            }

            50% {
                transform: scale(1.035);
                filter: saturate(1.15);
            }
        }

        @keyframes readyGlow {

            0%,
            100% {
                transform: scale(.92);
                opacity: .55;
            }

            50% {
                transform: scale(1.08);
                opacity: 1;
            }
        }

        .startBtn[disabled] {
            cursor: not-allowed;
            filter: grayscale(.25) opacity(.62);
            animation: none !important;
            box-shadow:
                inset 0 10px 18px rgba(255, 255, 255, .45),
                inset 0 -12px 18px rgba(0, 0, 0, .20),
                0 24px 60px rgba(0, 0, 0, .62);
        }

        .startBtn[disabled]::after {
            display: none;
        }

        .startInner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 7px;
            z-index: 2;
            text-align: center;
            padding: 10px;
        }

        .startInner img {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            object-fit: cover;
            box-shadow: 0 10px 20px rgba(0, 0, 0, .35);
            border: 1px solid rgba(4, 19, 40, .12);
            background: rgba(0, 0, 0, .05);
        }

        .pulse {
            position: absolute;
            inset: -40%;
            background: radial-gradient(circle, rgba(255, 122, 0, .28), transparent 55%);
            animation: pulse 2.2s ease-in-out infinite;
            z-index: 1;
            pointer-events: none;
            mix-blend-mode: screen;
            opacity: .75;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(.85);
                opacity: .55;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            flex: 1;
            border: none;
            border-radius: 16px;
            padding: 12px 14px;
            font-weight: 900;
            letter-spacing: .2px;
            cursor: pointer;
            color: rgba(255, 255, 255, .95);
            background: linear-gradient(180deg, rgba(255, 122, 0, .22), rgba(255, 122, 0, .10));
            border: 1px solid rgba(255, 122, 0, .30);
            box-shadow: 0 12px 30px rgba(0, 0, 0, .35);
            transition: transform .15s ease, background .2s ease;
        }

        .btn:active {
            transform: scale(.99);
        }

        .btn.secondary {
            background: rgba(0, 0, 0, .20);
            border: 1px solid rgba(255, 255, 255, .14);
            color: rgba(238, 246, 255, .9);
        }

        .overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 18px;
            background: rgba(0, 0, 0, .58);
            backdrop-filter: blur(9px);
            -webkit-backdrop-filter: blur(9px);
            z-index: 999;
        }

        .overlay.show {
            display: flex;
        }

        .modal {
            width: min(560px, 100%);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, .16);
            background: linear-gradient(180deg, rgba(255, 255, 255, .14), rgba(255, 255, 255, .08));
            box-shadow: 0 30px 95px rgba(0, 0, 0, .72);
            overflow: hidden;
            transform: translateY(18px) scale(.98);
            opacity: 0;
            animation: pop .35s ease forwards;
        }

        @keyframes pop {
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modalHead {
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            background: rgba(4, 19, 40, .55);
            border-bottom: 1px solid rgba(255, 255, 255, .10);
        }

        .modalHead strong {
            font-size: 14px;
            letter-spacing: .3px;
        }

        .x {
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 14px;
            cursor: pointer;
            color: rgba(255, 255, 255, .95);
            background: rgba(255, 122, 0, .14);
            border: 1px solid rgba(255, 122, 0, .25);
            box-shadow: 0 10px 25px rgba(0, 0, 0, .35);
        }

        .modalBody {
            padding: 18px 16px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: center;
        }

        .prizeBadge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 14px;
            border-radius: 999px;
            border: 1px solid rgba(255, 122, 0, .35);
            background: rgba(255, 122, 0, .12);
            box-shadow: inset 0 12px 24px rgba(0, 0, 0, .28);
            font-weight: 1000;
            letter-spacing: .4px;
            font-size: 13px;
            color: rgba(255, 255, 255, .95);
        }

        .prizeTitle {
            font-size: 20px;
            margin: 0;
            font-weight: 1000;
            letter-spacing: .2px;
            text-shadow: 0 10px 25px rgba(0, 0, 0, .45);
        }

        .prizeSub {
            margin: 0;
            color: var(--muted);
            font-size: 13px;
            line-height: 1.4;
        }

        .shine {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            padding: 14px 12px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: linear-gradient(180deg, rgba(255, 255, 255, .10), rgba(0, 0, 0, .12));
            box-shadow: 0 18px 45px rgba(0, 0, 0, .35);
        }

        .shine::after {
            content: "";
            position: absolute;
            inset: -90% -55%;
            background: linear-gradient(120deg, transparent 35%, rgba(255, 154, 42, .22), transparent 65%);
            transform: rotate(18deg);
            animation: shine 1.5s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes shine {
            0% {
                transform: translateX(-35%) rotate(18deg);
                opacity: .0;
            }

            20% {
                opacity: 1;
            }

            100% {
                transform: translateX(35%) rotate(18deg);
                opacity: .0;
            }
        }

        .confetti {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 1000;
        }

        .confetti i {
            position: absolute;
            width: 10px;
            height: 14px;
            border-radius: 3px;
            opacity: .95;
            animation: fall linear forwards;
            filter: drop-shadow(0 10px 14px rgba(0, 0, 0, .35));
            transform: translateY(-20px) rotate(0deg);
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(720deg);
                opacity: 0.95;
            }
        }

        .grandGlow {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 14px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 154, 42, .30), rgba(255, 122, 0, .10));
            border: 1px solid rgba(255, 154, 42, .45);
            box-shadow: 0 18px 60px rgba(255, 122, 0, .18), inset 0 12px 30px rgba(0, 0, 0, .18);
            font-weight: 1000;
            white-space: nowrap;
        }

        .shake {
            animation: shake .6s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-6px);
            }

            40% {
                transform: translateX(6px);
            }

            60% {
                transform: translateX(-4px);
            }

            80% {
                transform: translateX(4px);
            }
        }

        @media (max-width:380px) {
            .brand img {
                width: 40px;
                height: 40px;
            }

            .badge {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <div class="topbar">
            <div class="brand">
                <img src="img/logo.png" alt="Logo Mercado CastelÃ£o" onerror="this.style.display='none'">
                <div class="t">
                    <strong>Roleta Premiada â€” Mercado CastelÃ£o</strong>
                    <span>Boa sorte!</span>
                </div>
            </div>
            <div class="badge">1 giro por cliente</div>
        </div>

        <div class="card">
            <p class="hint">Toque em <b>START</b> para girar.</p>

            <div class="wheelWrap">
                <div class="wheelStage">
                    <div class="pointer" aria-hidden="true"></div>
                    <canvas id="wheel" width="900" height="900"></canvas>
                    <div class="rim" aria-hidden="true"></div>

                    <div class="center">
                        <button id="startBtn" class="startBtn isReady">
                            <span class="pulse" aria-hidden="true"></span>
                            <span class="startInner">
                                <img src="img/logo.png" alt="CastelÃ£o" onerror="this.style.display='none'">
                                <span>START</span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn secondary" id="resetBtn" type="button">PrÃ³ximo cliente</button>
                <button class="btn" id="testSpinBtn" type="button">Giro de teste</button>
            </div>
        </div>
    </div>

    <div class="confetti" id="confetti"></div>

    <div class="overlay" id="overlay" role="dialog" aria-modal="true">
        <div class="modal">
            <div class="modalHead">
                <strong>Resultado da Roleta</strong>
                <button class="x" id="closeModal" aria-label="Fechar">âœ•</button>
            </div>
            <div class="modalBody">
                <div class="prizeBadge" id="prizeBadge">ðŸŽ‰ ParabÃ©ns!</div>

                <div class="shine" id="shineBox">
                    <p class="prizeTitle" id="prizeTitle">â€”</p>
                    <p class="prizeSub" id="prizeSub">â€”</p>
                </div>

                <button class="btn" id="okBtn" type="button">OK</button>
            </div>
        </div>
    </div>

    <script>
        const PRIZES = [
            { label: "CAFÃ‰ DA MANHÃƒ", weight: 22, tone: "win" },
            { label: "DESCONTO DE 5%", weight: 22, tone: "win" },
            { label: "1 KG DE HORTIFRUTI", weight: 20, tone: "win" },
            { label: "GRANDE PRÃŠMIO R$200", weight: 1.5, tone: "grand" },
            { label: "VALE COMPRAS DE 100", weight: 11, tone: "win" },
            { label: "NÃƒO FOI DESSA VEZ", weight: 23.5, tone: "lose" },
        ];

        const canvas = document.getElementById("wheel");
        const ctx = canvas.getContext("2d");

        const startBtn = document.getElementById("startBtn");
        const resetBtn = document.getElementById("resetBtn");
        const testSpinBtn = document.getElementById("testSpinBtn");

        const overlay = document.getElementById("overlay");
        const closeModal = document.getElementById("closeModal");
        const okBtn = document.getElementById("okBtn");
        const prizeTitle = document.getElementById("prizeTitle");
        const prizeSub = document.getElementById("prizeSub");
        const prizeBadge = document.getElementById("prizeBadge");
        const shineBox = document.getElementById("shineBox");
        const confetti = document.getElementById("confetti");

        const N = PRIZES.length;
        const center = { x: canvas.width / 2, y: canvas.height / 2 };
        const radius = canvas.width * 0.46;
        const innerRadius = canvas.width * 0.11;

        let currentRotation = 0;
        let spinning = false;
        let locked = false;

        const COLORS = [
            ["#ff7a00", "#0a2350"],
            ["#ff9a2a", "#07162d"],
            ["#ff7a00", "#0a2350"],
            ["#ff9a2a", "#0a2350"],
            ["#ff7a00", "#07162d"],
            ["#eef6ff", "#b9d6ff"],
        ];

        function setStartReady(isReady) {
            startBtn.classList.toggle("isReady", !!isReady);
            startBtn.disabled = !isReady;
        }

        function roundRect(ctx, x, y, w, h, r) {
            const rr = Math.min(r, w / 2, h / 2);
            ctx.beginPath();
            ctx.moveTo(x + rr, y);
            ctx.arcTo(x + w, y, x + w, y + h, rr);
            ctx.arcTo(x + w, y + h, x, y + h, rr);
            ctx.arcTo(x, y + h, x, y, rr);
            ctx.arcTo(x, y, x + w, y, rr);
            ctx.closePath();
        }

        function drawStar(ctx, x, y, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            const step = Math.PI / spikes;
            ctx.beginPath();
            ctx.moveTo(x, y - outerRadius);
            for (let i = 0; i < spikes; i++) {
                ctx.lineTo(x + Math.cos(rot) * outerRadius, y + Math.sin(rot) * outerRadius);
                rot += step;
                ctx.lineTo(x + Math.cos(rot) * innerRadius, y + Math.sin(rot) * innerRadius);
                rot += step;
            }
            ctx.lineTo(x, y - outerRadius);
            ctx.closePath();
            ctx.fill();
        }

        function splitTwoLines(ctx, text, maxWidth) {
            const words = text.split(" ");
            let line1 = "";
            let line2 = "";
            for (const w of words) {
                const test = (line1 ? line1 + " " : "") + w;
                if (ctx.measureText(test).width <= maxWidth) {
                    line1 = test;
                } else {
                    line2 = (line2 ? line2 + " " : "") + w;
                }
            }
            return { line1, line2 };
        }

        function drawFittedText(ctx, text, x, y, maxWidth, baseSize) {
            const t = text.toUpperCase();
            let size = baseSize;
            ctx.font = `1000 ${size}px system-ui`;
            while (ctx.measureText(t).width > maxWidth && size > 18) {
                size -= 1;
                ctx.font = `1000 ${size}px system-ui`;
            }
            if (ctx.measureText(t).width <= maxWidth) {
                ctx.fillText(t, x, y);
                return;
            }
            let s = Math.min(size, 26);
            ctx.font = `1000 ${s}px system-ui`;
            const { line1, line2 } = splitTwoLines(ctx, t, maxWidth);
            if (!line2) {
                ctx.fillText(t, x, y);
                return;
            }
            while (ctx.measureText(line1).width > maxWidth && s > 16) {
                s -= 1; ctx.font = `1000 ${s}px system-ui`;
            }
            while (ctx.measureText(line2).width > maxWidth && s > 16) {
                s -= 1; ctx.font = `1000 ${s}px system-ui`;
            }
            const lh2 = Math.max(20, Math.round(s * 0.92));
            ctx.fillText(line1, x, y - lh2 / 2);
            ctx.fillText(line2, x, y + lh2 / 2);
        }

        function clipSlice(ctx, a0, a1, rOuter, rInner) {
            ctx.beginPath();
            ctx.arc(0, 0, rOuter, a0, a1, false);
            ctx.arc(0, 0, rInner, a1, a0, true);
            ctx.closePath();
            ctx.clip();
        }

        function drawWheel(rotationRad, timeMs) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.save();
            ctx.translate(center.x, center.y + 18);
            ctx.beginPath();
            ctx.arc(0, 0, radius * 1.02, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(0,0,0,.28)";
            ctx.filter = "blur(10px)";
            ctx.fill();
            ctx.restore();
            ctx.filter = "none";

            ctx.save();
            ctx.translate(center.x, center.y);
            ctx.rotate(rotationRad);

            const slice = (Math.PI * 2) / N;
            const glowPulse = 0.55 + 0.45 * Math.sin((timeMs || 0) * 0.004);

            for (let i = 0; i < N; i++) {
                const a0 = i * slice;
                const a1 = a0 + slice;
                const prize = PRIZES[i];

                const grad = ctx.createLinearGradient(
                    Math.cos(a0) * radius, Math.sin(a0) * radius,
                    Math.cos(a1) * radius, Math.sin(a1) * radius
                );

                const pair = COLORS[i % COLORS.length];

                if (prize.tone === "grand") {
                    grad.addColorStop(0, "#ffd36a");
                    grad.addColorStop(1, "#ff7a00");
                } else if (prize.tone === "lose") {
                    grad.addColorStop(0, "rgba(255,255,255,.92)");
                    grad.addColorStop(1, "rgba(185,214,255,.88)");
                } else {
                    grad.addColorStop(0, pair[0]);
                    grad.addColorStop(1, pair[1]);
                }

                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, a0, a1);
                ctx.closePath();
                ctx.fillStyle = grad;
                ctx.fill();

                ctx.strokeStyle = "rgba(255,255,255,.18)";
                ctx.lineWidth = 6;
                ctx.stroke();

                if (prize.tone === "grand") {
                    ctx.save();
                    ctx.shadowColor = `rgba(255, 211, 106, ${0.35 + 0.45 * glowPulse})`;
                    ctx.shadowBlur = 38 + 26 * glowPulse;
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.arc(0, 0, radius, a0, a1);
                    ctx.closePath();
                    ctx.strokeStyle = `rgba(255, 223, 122, ${0.55 + 0.35 * glowPulse})`;
                    ctx.lineWidth = 14;
                    ctx.stroke();
                    ctx.restore();

                    const mid = (a0 + a1) / 2;
                    const sparkR = radius * 0.86;
                    const sx = Math.cos(mid) * sparkR;
                    const sy = Math.sin(mid) * sparkR;

                    ctx.save();
                    ctx.translate(sx, sy);
                    ctx.rotate(-rotationRad - mid);
                    ctx.globalAlpha = 0.55 + 0.40 * glowPulse;
                    ctx.fillStyle = "rgba(255,223,122,.95)";
                    drawStar(ctx, 0, 0, 5, 10 + 4 * glowPulse, 5);
                    ctx.restore();
                }

                const mid = (a0 + a1) / 2;

                ctx.save();
                clipSlice(ctx, a0 + 0.015, a1 - 0.015, radius - 10, radius * 0.34);

                ctx.rotate(mid);
                ctx.translate(radius * 0.64, 0);
                ctx.rotate(Math.PI / 2);

                const text = prize.label.toUpperCase();
                const isGrand = prize.tone === "grand";
                const maxWidth = 290;

                const baseFont = isGrand ? 32 : 30;

                ctx.textAlign = "center";
                ctx.textBaseline = "middle";

                ctx.shadowColor = "rgba(0,0,0,.35)";
                ctx.shadowBlur = 10;

                if (isGrand) {
                    ctx.fillStyle = "rgba(0,0,0,.30)";
                    roundRect(ctx, -180, -38, 360, 76, 18);
                    ctx.fill();
                    ctx.strokeStyle = `rgba(255,223,122, ${0.55 + 0.35 * glowPulse})`;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                } else {
                    ctx.fillStyle = "rgba(0,0,0,.18)";
                    roundRect(ctx, -180, -36, 360, 72, 18);
                    ctx.fill();
                }

                ctx.fillStyle = prize.tone === "lose" ? "rgba(7,22,45,.96)" : "rgba(255,255,255,.96)";
                drawFittedText(ctx, text, 0, 0, maxWidth, baseFont);

                if (isGrand) {
                    ctx.shadowBlur = 0;
                    ctx.fillStyle = `rgba(255,223,122, ${0.60 + 0.35 * glowPulse})`;
                    drawStar(ctx, -160, -44, 5, 10 + 3 * glowPulse, 4.5);
                    drawStar(ctx, 160, 44, 5, 10 + 3 * glowPulse, 4.5);
                }

                ctx.restore();
            }

            ctx.beginPath();
            ctx.arc(0, 0, innerRadius * 2.1, 0, Math.PI * 2);
            const metal = ctx.createRadialGradient(0, -12, 10, 0, 0, innerRadius * 2.1);
            metal.addColorStop(0, "rgba(255,255,255,.75)");
            metal.addColorStop(1, "rgba(0,0,0,.35)");
            ctx.fillStyle = metal;
            ctx.fill();

            ctx.beginPath();
            ctx.arc(-innerRadius * 0.6, -innerRadius * 0.8, innerRadius * 0.65, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(255,255,255,.22)";
            ctx.fill();

            ctx.restore();

            ctx.save();
            ctx.translate(center.x, center.y);
            ctx.beginPath();
            ctx.arc(0, 0, radius * 1.015, 0, Math.PI * 2);
            ctx.strokeStyle = "rgba(255,154,42,.35)";
            ctx.lineWidth = 10;
            ctx.stroke();
            ctx.restore();
        }

        function pickPrizeIndex() {
            const total = PRIZES.reduce((s, p) => s + p.weight, 0);
            let r = Math.random() * total;
            for (let i = 0; i < PRIZES.length; i++) {
                r -= PRIZES[i].weight;
                if (r <= 0) return i;
            }
            return PRIZES.length - 1;
        }

        function spin({ force = false } = {}) {
            if (spinning) return;
            if (locked && !force) return;

            spinning = true;
            setStartReady(false);

            const index = pickPrizeIndex();
            const slice = (Math.PI * 2) / N;

            const targetMid = index * slice + slice / 2;
            const base = (-Math.PI / 2) - targetMid;

            const extraSpins = 6 + Math.floor(Math.random() * 3);
            const targetRotation = base + extraSpins * (Math.PI * 2);

            const start = performance.now();
            const duration = 5200;
            const from = currentRotation;
            const to = targetRotation;

            let lastTick = 0;
            const tickEvery = 120;

            function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }

            function anim(now) {
                const t = Math.min(1, (now - start) / duration);
                const e = easeOutCubic(t);
                currentRotation = from + (to - from) * e;
                drawWheel(currentRotation, now);

                if (now - lastTick > tickEvery && t < 0.92) {
                    lastTick = now;
                    if (navigator.vibrate) navigator.vibrate(8);
                }

                if (t < 1) {
                    requestAnimationFrame(anim);
                } else {
                    spinning = false;
                    if (!force) locked = true;
                    showResult(PRIZES[index]);
                }
            }
            requestAnimationFrame(anim);
        }

        function showResult(prize) {
            const isGrand = prize.tone === "grand";
            const isLose = prize.tone === "lose";

            prizeTitle.textContent = prize.label;

            if (isGrand) {
                prizeBadge.innerHTML = 'ðŸ† <span class="grandGlow">GRANDE PRÃŠMIO!</span>';
                prizeSub.textContent = "Valide o prÃªmio com a equipe responsÃ¡vel.";
                shineBox.classList.add("shake");
                burstConfetti(160);
            } else if (isLose) {
                prizeBadge.textContent = "ðŸ˜… Ops!";
                prizeSub.textContent = "NÃ£o foi dessa vezâ€¦ mas jÃ¡ valeu a diversÃ£o!";
                burstConfetti(28);
            } else {
                prizeBadge.textContent = "ðŸŽ‰ ParabÃ©ns!";
                prizeSub.textContent = "Mostre ao atendente para validar o prÃªmio.";
                burstConfetti(90);
            }

            overlay.classList.add("show");
            setTimeout(() => shineBox.classList.remove("shake"), 700);
        }

        function hideResult() {
            overlay.classList.remove("show");
            clearConfetti();
        }

        function burstConfetti(amount = 80) {
            clearConfetti();
            const colors = [
                "rgba(255,122,0,.95)",
                "rgba(255,154,42,.95)",
                "rgba(10,35,80,.95)",
                "rgba(238,246,255,.92)"
            ];
            for (let i = 0; i < amount; i++) {
                const p = document.createElement("i");
                const left = Math.random() * 100;
                const delay = Math.random() * 0.25;
                const dur = 1.9 + Math.random() * 1.6;
                const sizeW = 6 + Math.random() * 10;
                const sizeH = 8 + Math.random() * 14;

                p.style.left = left + "vw";
                p.style.top = (-10 - Math.random() * 30) + "px";
                p.style.background = colors[Math.floor(Math.random() * colors.length)];
                p.style.width = sizeW + "px";
                p.style.height = sizeH + "px";
                p.style.animationDuration = dur + "s";
                p.style.animationDelay = delay + "s";
                confetti.appendChild(p);
            }
            setTimeout(clearConfetti, 4200);
        }

        function clearConfetti() { confetti.innerHTML = ""; }

        function idleLoop(now) {
            if (!spinning) drawWheel(currentRotation, now);
            requestAnimationFrame(idleLoop);
        }

        startBtn.addEventListener("click", () => {
            if (spinning || locked) return;
            spin({ force: false });
        });

        resetBtn.addEventListener("click", () => {
            locked = false;
            setStartReady(true);
            currentRotation = currentRotation % (Math.PI * 2);
            if (navigator.vibrate) navigator.vibrate([20, 40, 20]);
        });

        testSpinBtn.addEventListener("click", () => { spin({ force: true }); });

        closeModal.addEventListener("click", hideResult);
        okBtn.addEventListener("click", hideResult);
        overlay.addEventListener("click", (e) => { if (e.target === overlay) hideResult(); });

        setStartReady(true);
        requestAnimationFrame(idleLoop);
    </script>
</body>

</html>
